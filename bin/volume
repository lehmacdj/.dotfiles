#!/usr/bin/env bash
set -euo pipefail
# use apple script to change the volume on Apple computers

if [ "$1" == "mute" ] || [ "$1" == "m" ]; then
  osascript -e "set volume with output muted"
elif [ "$1" == "unmute" ] || [ "$1" == "u" ]; then
  osascript -e "set volume without output muted"
elif [[ "$1" =~ ^[+-][0-9]+$ ]]; then # increment volume
  osascript -e "set volume output volume (output volume of (get volume settings) + $1) --100%"
elif [[ "$1" =~ ^[0-9]+$ ]]; then # set volume
  osascript -e "set volume output volume $1 --100%"
else
  2>&1 echo "usage: $0 [<amount>|+<amount>|-<amount>] [mute|m|unmute|u]"
fi
# this gets a string formatted like "17, false"
osascript -e "output volume of (get volume settings) & output muted of (get volume settings)" \
  | awk -F', ' '{printf "Volume: %d%% %s\n", $1, ($2 == "true" ? "(muted)" : "(unmuted)")}'
